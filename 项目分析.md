# 飞书字段管理项目分析

## 项目概述
项目位于 `/Users/a0000/Projects/feishu-update/code`，主要用于通过飞书API管理多维表格中的字段配置。

## 获取单个字段配置的方法

### 1. 通过 `get_field_info.js` 获取字段信息
这个文件实现了获取特定字段配置的功能：

1. **获取访问令牌**：调用飞书API获取tenant_access_token
2. **解析URL参数**：从URL中提取app_token、table_id和view_id
3. **获取字段列表**：调用listFields函数获取所有字段
4. **查找目标字段**：根据字段名称查找指定字段
5. **输出字段配置**：显示字段的ID、名称、类型、UI类型、属性等信息

关键代码：
```javascript
// 查找指定名称的字段
const targetField = fields.find(field => field.field_name === fieldName);

if (targetField) {
  console.log("找到字段:", fieldName);
  console.log("字段ID:", targetField.field_id);
  console.log("字段名称:", targetField.field_name);
  console.log("字段类型:", targetField.type);
  console.log("UI类型:", targetField.ui_type);
  console.log("字段属性:", targetField.property);
  
  // 如果是单选字段，输出选项信息
  if (targetField.type === 1 && targetField.property && targetField.property.options) {
    console.log("选项列表:");
    targetField.property.options.forEach(option => {
      console.log(`- ${option.name} (ID: ${option.id}, 颜色: ${option.color})`);
    });
  }
}
```

### 2. 通过 `main.js` 和 `main_fixed.js` 获取字段信息
这两个文件主要实现了字段更新功能，但也包含了获取字段信息的逻辑：

1. **获取访问令牌**：调用飞书API获取tenant_access_token
2. **解析基础URL**：从URL中提取app_token和table_id
3. **获取字段列表**：调用listFields函数获取所有字段
4. **查找目标字段**：根据字段ID或字段名称查找指定字段
5. **更新字段配置**：调用updateField函数更新字段配置

关键代码：
```javascript
// 查找目标字段
const targetFieldId = process.env.FIELD_ID;
const targetFieldName = process.env.FIELD_NAME;

let targetField;
if (targetFieldId) {
  targetField = fields.find(field => field.field_id === targetFieldId);
} else if (targetFieldName) {
  targetField = fields.find(field => field.field_name === targetFieldName);
}

if (!targetField) {
  console.error("未找到目标字段");
  console.log("所有字段列表:");
  fields.forEach(field => {
    console.log(`- ${field.field_name} (ID: ${field.field_id}, 类型: ${field.type})`);
  });
  throw new Error("未找到目标字段");
}
```

## 核心API调用

### 获取字段列表
```javascript
const url = `https://open.feishu.cn/open-apis/bitable/v1/apps/${appToken}/tables/${tableId}/fields?page_size=100${pageToken ? `&page_token=${encodeURIComponent(pageToken)}` : ""}`;

const headers = {
  Authorization: `Bearer ${tenantAccessToken}`,
  "Content-Type": "application/json; charset=utf-8",
};

const response = await axios.get(url, { headers });
const result = response.data;
```

### 获取访问令牌
```javascript
const url = "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal";

const response = await axios.post(url, {
  app_id: appID,
  app_secret: appSecret,
});

const result = response.data;
const tenantAccessToken = result.tenant_access_token;
```

## 总结

这个项目通过以下步骤获取单个字段的配置：

1. 首先获取飞书API的访问令牌
2. 解析URL参数获取app_token和table_id
3. 调用飞书API获取指定表格的所有字段列表
4. 在字段列表中根据字段ID或字段名称查找目标字段
5. 输出或使用目标字段的配置信息

这种方法是通过获取所有字段然后在客户端进行过滤来实现的，而不是直接通过API获取单个字段。飞书API本身也提供了获取单个字段的接口（GET /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/fields/{field_id}），但这个项目中没有使用该接口。