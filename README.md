# 飞书字段管理器

一个用于管理飞书多维表格字段配置的Web应用程序。

## GitHub仓库

本项目已开源，代码托管在GitHub：[https://github.com/davidwuwu001/feishu-field-manager](https://github.com/davidwuwu001/feishu-field-manager)

## 功能特点

- 字段列表展示
- 字段编辑功能
- 单选字段选项管理
- 飞书API集成

## 功能特性

- 🔐 用户认证：支持飞书API认证，可保存凭据以便下次使用
- 📊 表格管理：获取和显示飞书多维表格的基本信息
- 🔧 字段管理：支持字段的创建、编辑、删除和查看
- 🎨 选项管理：支持单选和多选字段的选项管理
- 📜 历史记录：记录字段变更历史，支持回滚操作
- 🔄 API代理：通过本地API服务器代理飞书API请求，解决跨域问题
- 💾 凭据存储：安全存储和管理用户认证凭据

## 技术栈

- React
- Ant Design
- Node.js
- Express
- 构建工具：Vite
- API：飞书开放平台API

## 项目结构

```
feishu-field-manager/
├── src/                 # 前端源码
├── api/                 # API接口
├── public/              # 静态资源
├── package.json         # 项目依赖
├── server.cjs           # 服务器配置
└── README.md           # 项目说明
```

## 开发进度

### 最新更新
- 修复了字段编辑页面中单选字段选项不显示的问题
  - 将条件判断从`field && field.hasOptions`改为`field && (field.type === '1' || field.type === '2')`
  - 确保单选和多选字段正确显示选项管理器
- 修复了组件导入问题
  - 为FieldEditPage.jsx添加了缺失的React导入语句
  - 为OptionsManager.jsx添加了缺失的React导入语句
  - 修复了重复导入问题
- 验证了选项编辑和删除功能
  - OptionsManager组件已实现完整的选项管理功能
  - 支持添加、编辑和删除选项
  - 支持选项颜色选择
  - 通过onUpdate回调将更新同步到父组件
- Token处理问题修复
  - 修复了tables.js API中的token获取逻辑
  - 解决了从请求头中正确提取Bearer token的问题
  - 重启了后端服务器以应用修复
- 字段名称修改问题修复
  - 修复了字段名称修改功能，解决了server.cjs中缺少不带ID参数的PUT路由问题

### 已完成功能
- [x] 项目初始化
- [x] 字段列表展示
- [x] 字段编辑功能
- [x] 单选字段选项管理
- [x] API集成
- [x] 错误处理

## 支持的字段类型

1. 文本 (text)
2. 数字 (number)
3. 单选 (single_select) - 支持选项管理
4. 多选 (multi_select) - 支持选项管理
5. 日期 (date)
6. 勾选框 (checkbox)
7. 人员 (user)
8. 电话号码 (phone)
9. 邮箱 (email)
10. 网址 (url)

## 安装和运行

### 前置要求

- Node.js 16+
- npm 或 yarn

### 安装依赖

```bash
npm install
```

### 启动开发服务器

1. 启动后端API服务器（端口3000）：
```bash
npm run server
```

2. 启动前端开发服务器（端口3004）：
```bash
npm run dev
```

3. 在浏览器中访问 http://localhost:3004

## 使用说明

1. **登录认证**：
   - 输入飞书访问令牌（Access Token）
   - 输入飞书多维表格URL
   - 可选择"记住我的凭据"以便下次使用

2. **查看字段列表**：
   - 登录后自动跳转到字段列表页面
   - 显示当前表格的所有字段信息
   - 可以查看字段类型、名称和其他属性

3. **创建字段**：
   - 点击"新建字段"按钮
   - 输入字段名称
   - 选择字段类型
   - 对于单选/多选字段，可以添加选项
   - 点击"保存"创建字段

4. **编辑字段**：
   - 在字段列表中点击"编辑"按钮
   - 修改字段信息
   - 对于单选/多选字段，可以编辑选项
   - 点击"保存"更新字段

5. **删除字段**：
   - 在字段列表中点击"删除"按钮
   - 确认删除操作

6. **管理选项**（单选/多选字段）：
   - 在字段编辑页面中，可以添加、编辑、删除选项
   - 可以为每个选项选择颜色
   - 选项更改会实时保存

## 更新日志

### 2023年12月5日
- 修复了"2条日志"保存失败问题
  - 修复了FieldEditPage组件中tableUrl获取问题（使用了错误的sessionStorage键名）
  - 修复了server.cjs中API路由的req.query、req.body和req.params未定义问题
  - 确保所有API路由都有适当的参数保护

### 2023年12月4日
- 实现了选项管理功能
  - 创建了OptionsManager组件，用于管理单选和多选字段的选项
  - 添加了选项的添加、删除和编辑功能
  - 实现了选项颜色的选择功能
- 修复了"2条日志"保存失败问题
  - 添加了options属性到字段配置中
  - 修复了后端API处理选项的逻辑
- 更新了字段编辑页面，集成了选项管理功能

### 2023年12月3日
- 实现了字段编辑功能
  - 创建了FieldEditPage组件，用于编辑现有字段
  - 添加了字段类型选择和配置选项
  - 实现了字段信息的保存和更新功能
- 完善了字段列表页面
  - 添加了字段编辑按钮
  - 优化了字段显示格式
  - 添加了字段类型标签

### 2023年12月2日
- 实现了字段创建功能
  - 创建了FieldCreatePage组件，用于创建新字段
  - 添加了字段类型选择和配置选项
  - 实现了字段信息的保存功能
- 完善了字段列表页面
  - 添加了字段创建按钮
  - 优化了字段显示格式

### 2023年12月1日
- 创建了项目基础结构
  - 使用Vite创建React项目
  - 配置了Ant Design UI框架
  - 设置了项目目录结构
- 实现了用户认证功能
  - 创建了AuthPage组件，用于用户登录
  - 实现了飞书API认证流程
  - 添加了凭据存储功能
- 实现了表格信息获取功能
  - 创建了API服务模块
  - 实现了飞书表格信息获取
  - 添加了错误处理机制
- 实现了字段列表功能
  - 创建了FieldListPage组件，显示字段列表
  - 实现了字段类型显示
  - 添加了字段编辑和删除按钮

## 注意事项

1. 确保飞书访问令牌有足够的权限访问目标表格
2. 表格URL必须是有效的飞书多维表格链接
3. 删除字段操作不可恢复，请谨慎操作
4. 选项管理功能目前仅支持单选和多选字段类型

## 开发日志

详细的开发日志请参考 [log.md](./log.md) 文件。

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 许可证

MIT License